# Configuration for Travis CI

env:
    global:
        - secure: "EHHzggqcLY/IfN9FhPHXjaF/8P02IBhmKEEHb1kP6NsmzAp3GfI/nhJnHRrXNGlH+PwwRErkZjTFXI+DHYOz9wPvaYBsrt2p0XZka0kGGPJkOIx9ibBnyQt1BcJigrt8MvFEBNkx+u8Jv147Sp9lbJlovl7NC2DCdY4ELR4ebNN1ZNfqhbheFPLMsFNQmCDl86nG4BaWctRkaE1rJBKWARrjfRGuNzveI52/AG1f0zsgbmmIvHpzmQM73cEI6+MNGiEnUVFqm+FEIS06GjHkqdbjjmMRotxx0vusqlroE8anlOi1uecJ5O2Y7vNKzV9rx8mBI14QaWJtddgFzS2+al4mpAaRtQKhVSu3hpW/wh4PhWEq+gahhZBboe+bDttrng4q+lqZPFwnNU2PpzPCbXWyxbLXFVR3eep5ryHltga7AzoNR5c7g8z1/qoPSIeA9CnW+0grkCQLWxIkjtCnydB09brmW8q7p+uJfvPnYNjguproRbYaTN1NNd3ybcLE5qQxXdfoUTd72jBHs3YHIJASOPeg8UL+8ca7b/mIUTG3F/9nd9wMXzBXz3EFSj0inZcbstcmE1Vf33O1eOKpa2IbFr/NMBMn3DX6JWnr2BjG2p4QTpqiqtryvmpwbTFqYUG8rWxqf4GP/5RhLi5niATTTo2l71S+cZZmxysEB9s="

languages: c

branches:
    only:
        - master
        - covscan

os:
    - linux

compilers:
    - gcc
    - clang

install:
    - sudo apt-get update -qq
    - sudo apt-get install -qq libpq-dev libmysqlclient-dev libsqlite3-dev
    - sudo apt-get install -qq libcunit1 libcunit1-dev
    - sudo pip install cpp-coveralls gcovr
    - wget https://github.com/libgit2/libgit2/archive/v0.23.4.tar.gz
    - tar -xzf v0.23.4.tar.gz
    - mkdir -p libgit2-build && cd libgit2-build
    - cmake --build=. ../libgit2-0.23.4 && make && sudo make install
    - cd .. ; rm -rf libgit2-build libgit2-0.23.4

script:
    - if [ -z ${COVERITY_SCAN_BRANCH} ] || [ ${COVERITY_SCAN_BRANCH} != 1 ] ; then ./configure && make && make test ; fi

after_success:
    - COVERALLS=1 make clean coverage

addons:
    coverity_scan:
        project:
            name: "thentenaar/mmm"
            description: "Minimal Migration Manager"
        notification_email: tim@hentenaar.com
        build_command_prepend: ./configure
        build_command: make
        branch_pattern: covscan
